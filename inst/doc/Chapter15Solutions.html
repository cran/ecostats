<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="David Warton" />

<meta name="date" content="2022-08-24" />

<title>Chapter 15 – Predicting multivariate abundances – Exercise solutions and Code Boxes</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Chapter 15 – Predicting multivariate
abundances – Exercise solutions and Code Boxes</h1>
<h4 class="author">David Warton</h4>
<h4 class="date">2022-08-24</h4>



<div id="exercise-15.1-predicting-fish-communities-at-wind-farms" class="section level2">
<h2>Exercise 15.1: Predicting fish communities at wind farms?</h2>
<p><em>Consider again Lena’s wind farm study (Exericise 14.3). She would
like to predict what fish occur where. What type of model should she
use, to get the best predictions?</em></p>
<p>The focus here is prediction so she should be using some model
designed to have good predictive performance. One thing that might help
is putting random effects on terms, that take different values for
different species, to borrow strength across species.</p>
</div>
<div id="exercise-15.2-which-environmental-variables-predict-hunting-spider-communities" class="section level2">
<h2>Exercise 15.2: Which environmental variables predict hunting spider
communities?</h2>
<p><em>Petrus set up 28 pitfall traps on sand dunes, in different
environmental conditions (in the open, under shrubs, etc) and classified
all hunting spiders that fell into the trap to species. He measured six
environmental variables characterising each site. He would like to know:
Which environmental variables best predict hunting spider
communities?</em></p>
<p><em>What analysis approach should he use?</em></p>
<p>This is a variable selection problem, he should be using multivariate
model selection techniques. One approach is to construct models designed
to be pretty good for prediction, and choose the one with best
predictive performance. For example, he could fit mixed models, with
random effects for different species, and use cross-validation to see
which set of predictors gives the model has best predictive
performance.</p>
</div>
<div id="code-box-15.1-predictive-likelihood-for-the-wind-farm-data" class="section level2">
<h2>Code Box 15.1: Predictive likelihood for the wind farm data</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ecostats)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(windFarms)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">5</span>) <span class="co"># use this seed to get the same results as below:</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>nStations <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">levels</span>(<span class="fu">as.factor</span>(windFarms<span class="sc">$</span>X<span class="sc">$</span>Station)))</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>isTestStn <span class="ot">=</span> <span class="fu">sample</span>(nStations,nStations<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>isTest <span class="ot">=</span> windFarms<span class="sc">$</span>X<span class="sc">$</span>Station <span class="sc">%in%</span> <span class="fu">levels</span>(windFarms<span class="sc">$</span>X<span class="sc">$</span>Station)[isTestStn]</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mvabund)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>windMV <span class="ot">=</span> <span class="fu">mvabund</span>(windFarms<span class="sc">$</span>abund)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>windFt_Train<span class="ot">=</span><span class="fu">manyglm</span>(windMV[isTest<span class="sc">==</span><span class="cn">FALSE</span>,]<span class="sc">~</span>Year<span class="sc">+</span>Zone,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">data=</span>windFarms<span class="sc">$</span>X[isTest<span class="sc">==</span><span class="cn">FALSE</span>,],<span class="at">family=</span><span class="st">&quot;poisson&quot;</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>windFt_Int_Train<span class="ot">=</span><span class="fu">manyglm</span>(windMV[isTest<span class="sc">==</span><span class="cn">FALSE</span>,]<span class="sc">~</span>Year<span class="sc">*</span>Zone,</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">data=</span>windFarms<span class="sc">$</span>X[isTest<span class="sc">==</span><span class="cn">FALSE</span>,],<span class="at">family=</span><span class="st">&quot;poisson&quot;</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>prWind_Test <span class="ot">=</span> <span class="fu">predict.manyglm</span>(windFt_Train,<span class="at">newdata=</span>windFarms<span class="sc">$</span>X[isTest,], <span class="at">type=</span><span class="st">&quot;response&quot;</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>prWind_Int_Test <span class="ot">=</span> <span class="fu">predict.manyglm</span>(windFt_Int_Train, <span class="at">newdata=</span>windFarms<span class="sc">$</span>X[isTest,], <span class="at">type=</span><span class="st">&quot;response&quot;</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>predLogL <span class="ot">=</span> <span class="fu">dpois</span>(windMV[isTest,],<span class="at">lambda=</span>prWind_Test,<span class="at">log=</span><span class="cn">TRUE</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>predLogL_Int <span class="ot">=</span> <span class="fu">dpois</span>(windMV[isTest,],<span class="at">lambda=</span>prWind_Int_Test,<span class="at">log=</span><span class="cn">TRUE</span>)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="fu">sum</span>(predLogL),<span class="fu">sum</span>(predLogL_Int))</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] -931.5643 -928.3885</span></span></code></pre></div>
<p><em>What do these results tell us about which model is
preferred?</em></p>
<p>These results suggest the main effect model is better.</p>
</div>
<div id="exercise-15.3-cross-validation-for-wind-farm-data-and-rare-species" class="section level2">
<h2>Exercise 15.3: Cross-validation for wind farm data and rare
species</h2>
<p><em>Repeat the analyses of Code Box 15.1 but after removing rare
species (observed less than 10 times), using the following
code:</em></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>notRare<span class="ot">=</span><span class="fu">colSums</span>(windMV<span class="sc">&gt;</span><span class="dv">0</span>)<span class="sc">&gt;</span><span class="dv">10</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>windMVnotRare<span class="ot">=</span><span class="fu">mvabund</span>(windFarms<span class="sc">$</span>abund[,notRare])</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>windFt_TrainRare<span class="ot">=</span><span class="fu">manyglm</span>(windMVnotRare[isTest<span class="sc">==</span><span class="cn">FALSE</span>,]<span class="sc">~</span>Year<span class="sc">+</span>Zone,</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">data=</span>windFarms<span class="sc">$</span>X[isTest<span class="sc">==</span><span class="cn">FALSE</span>,],<span class="at">family=</span><span class="st">&quot;poisson&quot;</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>windFt_Int_TrainRare<span class="ot">=</span><span class="fu">manyglm</span>(windMVnotRare[isTest<span class="sc">==</span><span class="cn">FALSE</span>,]<span class="sc">~</span>Year<span class="sc">*</span>Zone,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">data=</span>windFarms<span class="sc">$</span>X[isTest<span class="sc">==</span><span class="cn">FALSE</span>,],<span class="at">family=</span><span class="st">&quot;poisson&quot;</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>prWind_TestRare <span class="ot">=</span> <span class="fu">predict.manyglm</span>(windFt_TrainRare,<span class="at">newdata=</span>windFarms<span class="sc">$</span>X[isTest,], <span class="at">type=</span><span class="st">&quot;response&quot;</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>prWind_Int_TestRare <span class="ot">=</span> <span class="fu">predict.manyglm</span>(windFt_Int_TrainRare, <span class="at">newdata=</span>windFarms<span class="sc">$</span>X[isTest,], <span class="at">type=</span><span class="st">&quot;response&quot;</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>predLogLRare <span class="ot">=</span> <span class="fu">dpois</span>(windMVnotRare[isTest,],<span class="at">lambda=</span>prWind_TestRare,<span class="at">log=</span><span class="cn">TRUE</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>predLogL_IntRare <span class="ot">=</span> <span class="fu">dpois</span>(windMVnotRare[isTest,],<span class="at">lambda=</span>prWind_Int_TestRare,<span class="at">log=</span><span class="cn">TRUE</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="fu">sum</span>(predLogLRare),<span class="fu">sum</span>(predLogL_IntRare))</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] -781.0415 -788.9616</span></span></code></pre></div>
<p><em>Did you get a similar answer?</em></p>
<p>Nope – now the model with an interaction term looks better!</p>
<p><em>Note that so far we have only considered one test sample, and
there is randomness in the choice of training/test split. Repeat the
analyses of Code Box 15.1 as well as those you have done here, with and
without rare species, multiple times (which is a form of
cross-validation).</em></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>) <span class="co"># use this seed to get the same results as below:</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>nStations <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">levels</span>(<span class="fu">as.factor</span>(windFarms<span class="sc">$</span>X<span class="sc">$</span>Station)))</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>isTestStn <span class="ot">=</span> <span class="fu">sample</span>(nStations,nStations<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>isTest <span class="ot">=</span> windFarms<span class="sc">$</span>X<span class="sc">$</span>Station <span class="sc">%in%</span> <span class="fu">levels</span>(windFarms<span class="sc">$</span>X<span class="sc">$</span>Station)[isTestStn]</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>windFt_Train<span class="ot">=</span><span class="fu">manyglm</span>(windMV[isTest<span class="sc">==</span><span class="cn">FALSE</span>,]<span class="sc">~</span>Year<span class="sc">+</span>Zone,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">data=</span>windFarms<span class="sc">$</span>X[isTest<span class="sc">==</span><span class="cn">FALSE</span>,],<span class="at">family=</span><span class="st">&quot;poisson&quot;</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>windFt_Int_Train<span class="ot">=</span><span class="fu">manyglm</span>(windMV[isTest<span class="sc">==</span><span class="cn">FALSE</span>,]<span class="sc">~</span>Year<span class="sc">*</span>Zone,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">data=</span>windFarms<span class="sc">$</span>X[isTest<span class="sc">==</span><span class="cn">FALSE</span>,],<span class="at">family=</span><span class="st">&quot;poisson&quot;</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>prWind_Test <span class="ot">=</span> <span class="fu">predict.manyglm</span>(windFt_Train,<span class="at">newdata=</span>windFarms<span class="sc">$</span>X[isTest,], <span class="at">type=</span><span class="st">&quot;response&quot;</span>)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>prWind_Int_Test <span class="ot">=</span> <span class="fu">predict.manyglm</span>(windFt_Int_Train, <span class="at">newdata=</span>windFarms<span class="sc">$</span>X[isTest,], <span class="at">type=</span><span class="st">&quot;response&quot;</span>)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>predLogL <span class="ot">=</span> <span class="fu">dpois</span>(windMV[isTest,],<span class="at">lambda=</span>prWind_Test,<span class="at">log=</span><span class="cn">TRUE</span>)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>predLogL_Int <span class="ot">=</span> <span class="fu">dpois</span>(windMV[isTest,],<span class="at">lambda=</span>prWind_Int_Test,<span class="at">log=</span><span class="cn">TRUE</span>)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="fu">sum</span>(predLogL),<span class="fu">sum</span>(predLogL_Int))</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] -915.8434 -970.8314</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>windFt_TrainRare<span class="ot">=</span><span class="fu">manyglm</span>(windMVnotRare[isTest<span class="sc">==</span><span class="cn">FALSE</span>,]<span class="sc">~</span>Year<span class="sc">+</span>Zone,</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">data=</span>windFarms<span class="sc">$</span>X[isTest<span class="sc">==</span><span class="cn">FALSE</span>,],<span class="at">family=</span><span class="st">&quot;poisson&quot;</span>)</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>windFt_Int_TrainRare<span class="ot">=</span><span class="fu">manyglm</span>(windMVnotRare[isTest<span class="sc">==</span><span class="cn">FALSE</span>,]<span class="sc">~</span>Year<span class="sc">*</span>Zone,</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">data=</span>windFarms<span class="sc">$</span>X[isTest<span class="sc">==</span><span class="cn">FALSE</span>,],<span class="at">family=</span><span class="st">&quot;poisson&quot;</span>)</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>prWind_TestRare <span class="ot">=</span> <span class="fu">predict.manyglm</span>(windFt_TrainRare,<span class="at">newdata=</span>windFarms<span class="sc">$</span>X[isTest,], <span class="at">type=</span><span class="st">&quot;response&quot;</span>)</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>prWind_Int_TestRare <span class="ot">=</span> <span class="fu">predict.manyglm</span>(windFt_Int_TrainRare, <span class="at">newdata=</span>windFarms<span class="sc">$</span>X[isTest,], <span class="at">type=</span><span class="st">&quot;response&quot;</span>)</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>predLogLRare <span class="ot">=</span> <span class="fu">dpois</span>(windMVnotRare[isTest,],<span class="at">lambda=</span>prWind_TestRare,<span class="at">log=</span><span class="cn">TRUE</span>)</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>predLogL_IntRare <span class="ot">=</span> <span class="fu">dpois</span>(windMVnotRare[isTest,],<span class="at">lambda=</span>prWind_Int_TestRare,<span class="at">log=</span><span class="cn">TRUE</span>)</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="fu">sum</span>(predLogLRare),<span class="fu">sum</span>(predLogL_IntRare))</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] -734.4901 -780.1963</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2</span>) <span class="co"># use this seed to get the same results as below:</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>nStations <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">levels</span>(<span class="fu">as.factor</span>(windFarms<span class="sc">$</span>X<span class="sc">$</span>Station)))</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>isTestStn <span class="ot">=</span> <span class="fu">sample</span>(nStations,nStations<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>isTest <span class="ot">=</span> windFarms<span class="sc">$</span>X<span class="sc">$</span>Station <span class="sc">%in%</span> <span class="fu">levels</span>(windFarms<span class="sc">$</span>X<span class="sc">$</span>Station)[isTestStn]</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mvabund)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>windMV <span class="ot">=</span> <span class="fu">mvabund</span>(windFarms<span class="sc">$</span>abund)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>windFt_Train<span class="ot">=</span><span class="fu">manyglm</span>(windMV[isTest<span class="sc">==</span><span class="cn">FALSE</span>,]<span class="sc">~</span>Year<span class="sc">+</span>Zone,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">data=</span>windFarms<span class="sc">$</span>X[isTest<span class="sc">==</span><span class="cn">FALSE</span>,],<span class="at">family=</span><span class="st">&quot;poisson&quot;</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>windFt_Int_Train<span class="ot">=</span><span class="fu">manyglm</span>(windMV[isTest<span class="sc">==</span><span class="cn">FALSE</span>,]<span class="sc">~</span>Year<span class="sc">*</span>Zone,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">data=</span>windFarms<span class="sc">$</span>X[isTest<span class="sc">==</span><span class="cn">FALSE</span>,],<span class="at">family=</span><span class="st">&quot;poisson&quot;</span>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>prWind_Test <span class="ot">=</span> <span class="fu">predict.manyglm</span>(windFt_Train,<span class="at">newdata=</span>windFarms<span class="sc">$</span>X[isTest,], <span class="at">type=</span><span class="st">&quot;response&quot;</span>)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>prWind_Int_Test <span class="ot">=</span> <span class="fu">predict.manyglm</span>(windFt_Int_Train, <span class="at">newdata=</span>windFarms<span class="sc">$</span>X[isTest,], <span class="at">type=</span><span class="st">&quot;response&quot;</span>)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>predLogL <span class="ot">=</span> <span class="fu">dpois</span>(windMV[isTest,],<span class="at">lambda=</span>prWind_Test,<span class="at">log=</span><span class="cn">TRUE</span>)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>predLogL_Int <span class="ot">=</span> <span class="fu">dpois</span>(windMV[isTest,],<span class="at">lambda=</span>prWind_Int_Test,<span class="at">log=</span><span class="cn">TRUE</span>)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="fu">sum</span>(predLogL),<span class="fu">sum</span>(predLogL_Int))</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] -886.4941 -992.3476</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>windFt_TrainRare<span class="ot">=</span><span class="fu">manyglm</span>(windMVnotRare[isTest<span class="sc">==</span><span class="cn">FALSE</span>,]<span class="sc">~</span>Year<span class="sc">+</span>Zone,</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">data=</span>windFarms<span class="sc">$</span>X[isTest<span class="sc">==</span><span class="cn">FALSE</span>,],<span class="at">family=</span><span class="st">&quot;poisson&quot;</span>)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>windFt_Int_TrainRare<span class="ot">=</span><span class="fu">manyglm</span>(windMVnotRare[isTest<span class="sc">==</span><span class="cn">FALSE</span>,]<span class="sc">~</span>Year<span class="sc">*</span>Zone,</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">data=</span>windFarms<span class="sc">$</span>X[isTest<span class="sc">==</span><span class="cn">FALSE</span>,],<span class="at">family=</span><span class="st">&quot;poisson&quot;</span>)</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>prWind_TestRare <span class="ot">=</span> <span class="fu">predict.manyglm</span>(windFt_TrainRare,<span class="at">newdata=</span>windFarms<span class="sc">$</span>X[isTest,], <span class="at">type=</span><span class="st">&quot;response&quot;</span>)</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>prWind_Int_TestRare <span class="ot">=</span> <span class="fu">predict.manyglm</span>(windFt_Int_TrainRare, <span class="at">newdata=</span>windFarms<span class="sc">$</span>X[isTest,], <span class="at">type=</span><span class="st">&quot;response&quot;</span>)</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>predLogLRare <span class="ot">=</span> <span class="fu">dpois</span>(windMVnotRare[isTest,],<span class="at">lambda=</span>prWind_TestRare,<span class="at">log=</span><span class="cn">TRUE</span>)</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>predLogL_IntRare <span class="ot">=</span> <span class="fu">dpois</span>(windMVnotRare[isTest,],<span class="at">lambda=</span>prWind_Int_TestRare,<span class="at">log=</span><span class="cn">TRUE</span>)</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="fu">sum</span>(predLogLRare),<span class="fu">sum</span>(predLogL_IntRare))</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] -756.8341 -865.5058</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">3</span>) <span class="co"># use this seed to get the same results as below:</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>nStations <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">levels</span>(<span class="fu">as.factor</span>(windFarms<span class="sc">$</span>X<span class="sc">$</span>Station)))</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>isTestStn <span class="ot">=</span> <span class="fu">sample</span>(nStations,nStations<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>isTest <span class="ot">=</span> windFarms<span class="sc">$</span>X<span class="sc">$</span>Station <span class="sc">%in%</span> <span class="fu">levels</span>(windFarms<span class="sc">$</span>X<span class="sc">$</span>Station)[isTestStn]</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mvabund)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>windMV <span class="ot">=</span> <span class="fu">mvabund</span>(windFarms<span class="sc">$</span>abund)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>windFt_Train<span class="ot">=</span><span class="fu">manyglm</span>(windMV[isTest<span class="sc">==</span><span class="cn">FALSE</span>,]<span class="sc">~</span>Year<span class="sc">+</span>Zone,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">data=</span>windFarms<span class="sc">$</span>X[isTest<span class="sc">==</span><span class="cn">FALSE</span>,],<span class="at">family=</span><span class="st">&quot;poisson&quot;</span>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>windFt_Int_Train<span class="ot">=</span><span class="fu">manyglm</span>(windMV[isTest<span class="sc">==</span><span class="cn">FALSE</span>,]<span class="sc">~</span>Year<span class="sc">*</span>Zone,</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">data=</span>windFarms<span class="sc">$</span>X[isTest<span class="sc">==</span><span class="cn">FALSE</span>,],<span class="at">family=</span><span class="st">&quot;poisson&quot;</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>prWind_Test <span class="ot">=</span> <span class="fu">predict.manyglm</span>(windFt_Train,<span class="at">newdata=</span>windFarms<span class="sc">$</span>X[isTest,], <span class="at">type=</span><span class="st">&quot;response&quot;</span>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>prWind_Int_Test <span class="ot">=</span> <span class="fu">predict.manyglm</span>(windFt_Int_Train, <span class="at">newdata=</span>windFarms<span class="sc">$</span>X[isTest,], <span class="at">type=</span><span class="st">&quot;response&quot;</span>)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>predLogL <span class="ot">=</span> <span class="fu">dpois</span>(windMV[isTest,],<span class="at">lambda=</span>prWind_Test,<span class="at">log=</span><span class="cn">TRUE</span>)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>predLogL_Int <span class="ot">=</span> <span class="fu">dpois</span>(windMV[isTest,],<span class="at">lambda=</span>prWind_Int_Test,<span class="at">log=</span><span class="cn">TRUE</span>)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="fu">sum</span>(predLogL),<span class="fu">sum</span>(predLogL_Int))</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] -830.5662 -832.3659</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>windFt_TrainRare<span class="ot">=</span><span class="fu">manyglm</span>(windMVnotRare[isTest<span class="sc">==</span><span class="cn">FALSE</span>,]<span class="sc">~</span>Year<span class="sc">+</span>Zone,</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">data=</span>windFarms<span class="sc">$</span>X[isTest<span class="sc">==</span><span class="cn">FALSE</span>,],<span class="at">family=</span><span class="st">&quot;poisson&quot;</span>)</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>windFt_Int_TrainRare<span class="ot">=</span><span class="fu">manyglm</span>(windMVnotRare[isTest<span class="sc">==</span><span class="cn">FALSE</span>,]<span class="sc">~</span>Year<span class="sc">*</span>Zone,</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">data=</span>windFarms<span class="sc">$</span>X[isTest<span class="sc">==</span><span class="cn">FALSE</span>,],<span class="at">family=</span><span class="st">&quot;poisson&quot;</span>)</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>prWind_TestRare <span class="ot">=</span> <span class="fu">predict.manyglm</span>(windFt_TrainRare,<span class="at">newdata=</span>windFarms<span class="sc">$</span>X[isTest,], <span class="at">type=</span><span class="st">&quot;response&quot;</span>)</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>prWind_Int_TestRare <span class="ot">=</span> <span class="fu">predict.manyglm</span>(windFt_Int_TrainRare, <span class="at">newdata=</span>windFarms<span class="sc">$</span>X[isTest,], <span class="at">type=</span><span class="st">&quot;response&quot;</span>)</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>predLogLRare <span class="ot">=</span> <span class="fu">dpois</span>(windMVnotRare[isTest,],<span class="at">lambda=</span>prWind_TestRare,<span class="at">log=</span><span class="cn">TRUE</span>)</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>predLogL_IntRare <span class="ot">=</span> <span class="fu">dpois</span>(windMVnotRare[isTest,],<span class="at">lambda=</span>prWind_Int_TestRare,<span class="at">log=</span><span class="cn">TRUE</span>)</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="fu">sum</span>(predLogLRare),<span class="fu">sum</span>(predLogL_IntRare))</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] -734.7738 -738.2911</span></span></code></pre></div>
<p><em>Which set of results tends to be more reliable (less variable) –
the ones with or without the rare species? Why do you think this
happened?</em></p>
<p>Without the rare species, the results are more reliable, with
predictive likelihood usually in the mid -700’s, and the interaction
model consistently performing better (although sometimes narrowly so).
With rare species, it bounces around a lot more, with the smaller model
(main effects only) sometimes having better predictive performance. This
is likely because rare species with all absences in one treatment
combination can blow up the predictive likelihood (if they are predicted
to have a mean of zero, but have some non-zero cases in test data).</p>
</div>
<div id="code-box-15.2-fitting-a-mixed-model-to-the-wind-farm-data" class="section level2">
<h2>Code Box 15.2: Fitting a mixed model to the wind farm data</h2>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>windComp <span class="ot">=</span> <span class="fu">manyglm</span>(windMV<span class="sc">~</span>Zone<span class="sc">*</span>Year,<span class="at">data=</span>windFarms<span class="sc">$</span>X,<span class="at">composition=</span><span class="cn">TRUE</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmmTMB)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>wind_glmm <span class="ot">=</span> <span class="fu">glmmTMB</span>(windMV<span class="sc">~</span>Year<span class="sc">*</span>Zone<span class="sc">+</span><span class="fu">diag</span>(Year<span class="sc">*</span>Zone<span class="sc">|</span>cols),</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="at">family=</span><span class="fu">poisson</span>(), <span class="at">data=</span>windComp<span class="sc">$</span>data)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(wind_glmm)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Family: poisson  ( log )</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Formula:          windMV ~ Year * Zone + diag(Year * Zone | cols)</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Data: windComp$data</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      AIC      BIC   logLik deviance df.resid </span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   3259.9   3331.4  -1617.9   3235.9     2852 </span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Random effects:</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Conditional model:</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Groups Name           Variance Std.Dev. Corr                     </span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  cols   (Intercept)    5.3421   2.3113                            </span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         Year2010       1.6302   1.2768   0.00                     </span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         ZoneN          0.6807   0.8251   0.00 0.00                </span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         ZoneS          3.9012   1.9751   0.00 0.00 0.00           </span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         Year2010:ZoneN 0.8519   0.9230   0.00 0.00 0.00 0.00      </span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         Year2010:ZoneS 0.3777   0.6146   0.00 0.00 0.00 0.00 0.00 </span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Number of obs: 2864, groups:  cols, 16</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Conditional model:</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; (Intercept)    -3.18913    0.65414  -4.875 1.09e-06 ***</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Year2010       -0.26989    0.45008  -0.600    0.549    </span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ZoneN          -0.15541    0.35209  -0.441    0.659    </span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ZoneS          -0.16619    0.61670  -0.269    0.788    </span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Year2010:ZoneN  0.08998    0.41305   0.218    0.828    </span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Year2010:ZoneS  0.56211    0.37247   1.509    0.131    </span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ---</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span></code></pre></div>
</div>
<div id="exercise-15.4-predictive-likelihood-for-wind-farm-mixed-model" class="section level2">
<h2>Exercise 15.4: Predictive likelihood for wind farm mixed model</h2>
<p><em>Calculate the predictive likelihood for the mixed model fitted to
the wind farm data (Code Box 15.2), following the method in Code Box
15.1.</em></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>isTest <span class="ot">=</span> windComp<span class="sc">$</span>data<span class="sc">$</span>Station <span class="sc">%in%</span> <span class="fu">levels</span>(windComp<span class="sc">$</span>data<span class="sc">$</span>Station)[isTestStn]</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>wind_glmm <span class="ot">=</span> <span class="fu">glmmTMB</span>(windMV<span class="sc">~</span>Year<span class="sc">*</span>Zone<span class="sc">+</span><span class="fu">diag</span>(Year<span class="sc">*</span>Zone<span class="sc">|</span>cols),</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family=</span><span class="fu">poisson</span>(), <span class="at">data=</span>windComp<span class="sc">$</span>data[isTest<span class="sc">==</span><span class="cn">FALSE</span>,])</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>prGLMM_Test <span class="ot">=</span> <span class="fu">predict</span>(wind_glmm, <span class="at">newdata=</span>windComp<span class="sc">$</span>data[isTest<span class="sc">==</span><span class="cn">TRUE</span>,], <span class="at">type=</span><span class="st">&quot;response&quot;</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>predGLMM <span class="ot">=</span> <span class="fu">sum</span>(<span class="fu">dpois</span>(windComp<span class="sc">$</span>data<span class="sc">$</span>windMV[isTest<span class="sc">==</span><span class="cn">TRUE</span>],<span class="at">lambda=</span>prGLMM_Test,<span class="at">log=</span><span class="cn">TRUE</span>))</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(predGLMM,<span class="fu">sum</span>(predLogL))</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] -744.1239 -830.5662</span></span></code></pre></div>
<p><em>Did this have better predictive performance? Why do you think
this happened?</em></p>
<p>This did waaaay better than <code>manyglm</code>. Probably because it
was borrowing strength across species to better predict rare ones, not
overfitting quite as badly.</p>
</div>
<div id="code-box-15.3-fitting-a-lasso-to-the-wind-farm-data-via-glmnet" class="section level2">
<h2>Code Box 15.3: Fitting a LASSO to the wind farm data via glmnet</h2>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmnet)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">model.matrix</span>(windMV<span class="sc">~</span>Year<span class="sc">*</span>Zone<span class="sc">*</span>cols,<span class="at">data=</span>windComp<span class="sc">$</span>data)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> windComp<span class="sc">$</span>data<span class="sc">$</span>windMV</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>windLasso <span class="ot">=</span> <span class="fu">glmnet</span>(X,y, <span class="at">family=</span><span class="st">&quot;poisson&quot;</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>isTest <span class="ot">=</span> windComp<span class="sc">$</span>data<span class="sc">$</span>Station <span class="sc">%in%</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(windComp<span class="sc">$</span>data<span class="sc">$</span>Station)[isTestStn]</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>windLassoTrain <span class="ot">=</span> <span class="fu">glmnet</span>(X[isTest<span class="sc">==</span><span class="cn">FALSE</span>,], y[isTest<span class="sc">==</span><span class="cn">FALSE</span>], <span class="at">family=</span><span class="st">&quot;poisson&quot;</span>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>prLassoTest <span class="ot">=</span> <span class="fu">predict</span>(windLassoTrain,X[isTest,],<span class="at">type=</span><span class="st">&quot;response&quot;</span>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>predLLlasso<span class="ot">=</span><span class="fu">colSums</span>(<span class="fu">dpois</span>(windComp<span class="sc">$</span>data<span class="sc">$</span>windMV[isTest],prLassoTest,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="at">log=</span><span class="cn">TRUE</span>))</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(windLassoTrain<span class="sc">$</span>lambda,predLLlasso,<span class="at">type=</span><span class="st">&quot;l&quot;</span>,<span class="at">log=</span><span class="st">&quot;x&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="data:image/png;base64,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" alt />
<p class="caption">plot of chunk code15.3</p>
</div>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>isBestLambda <span class="ot">=</span> <span class="fu">which</span>(predLLlasso<span class="sc">==</span><span class="fu">max</span>(predLLlasso))</span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">matplot</span>(windLasso<span class="sc">$</span>lambda,<span class="fu">t</span>(windLasso<span class="sc">$</span>beta),<span class="at">type=</span><span class="st">&quot;n&quot;</span>, <span class="at">log=</span><span class="st">&quot;x&quot;</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">matlines</span>(windLasso<span class="sc">$</span>lambda,<span class="fu">t</span>(windLasso<span class="sc">$</span>beta))</span></code></pre></div>
<div class="figure">
<img src="data:image/png;base64,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" alt />
<p class="caption">plot of chunk code15.3beta</p>
</div>
</div>
<div id="code-box-15.4-fitting-a-group-lasso-to-the-wind-farm-data" class="section level2">
<h2>Code Box 15.4: Fitting a group-LASSO to the wind farm data</h2>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(grplasso)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>windLambdaTrain <span class="ot">=</span> <span class="fu">lambdamax</span>(windMV<span class="sc">~</span>Year<span class="sc">*</span>Zone<span class="sc">*</span>cols, <span class="at">data=</span>windComp<span class="sc">$</span>data,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">subset=</span>isTest<span class="sc">==</span><span class="cn">FALSE</span>, <span class="at">model =</span> <span class="fu">PoissReg</span>()) <span class="sc">*</span> <span class="fl">0.7</span><span class="sc">^</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">19</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>windGrplasso <span class="ot">=</span> <span class="fu">grplasso</span>(windMV<span class="sc">~</span>Year<span class="sc">*</span>Zone<span class="sc">*</span>cols, <span class="at">data=</span>windComp<span class="sc">$</span>data,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">lambda=</span>windLambdaTrain, <span class="at">subset=</span>isTest<span class="sc">==</span><span class="cn">FALSE</span>, <span class="at">model =</span> <span class="fu">PoissReg</span>())</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Lambda: 556.505  nr.var: 16 </span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Lambda: 389.5535  nr.var: 31 </span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Lambda: 272.6875  nr.var: 61 </span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Lambda: 190.8812  nr.var: 61 </span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Lambda: 133.6169  nr.var: 61 </span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Lambda: 93.5318  nr.var: 61 </span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Lambda: 65.47226  nr.var: 91 </span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Lambda: 45.83058  nr.var: 91 </span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Lambda: 32.08141  nr.var: 91 </span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Lambda: 22.45699  nr.var: 91 </span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Lambda: 15.71989  nr.var: 91 </span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Lambda: 11.00392  nr.var: 91 </span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Lambda: 7.702746  nr.var: 91 </span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Lambda: 5.391922  nr.var: 91 </span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Lambda: 3.774346  nr.var: 91 </span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Lambda: 2.642042  nr.var: 91 </span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Lambda: 1.849429  nr.var: 91 </span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Lambda: 1.294601  nr.var: 91 </span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Lambda: 0.9062204  nr.var: 91 </span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Lambda: 0.6343543  nr.var: 91</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>prGrpTest <span class="ot">=</span> <span class="fu">predict</span>(windGrplasso,<span class="at">newdata=</span>windComp<span class="sc">$</span>data[isTest,], <span class="at">type=</span><span class="st">&quot;response&quot;</span>)</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>predLLgrplasso <span class="ot">=</span> <span class="fu">colSums</span>(<span class="fu">dpois</span>(windComp<span class="sc">$</span>data<span class="sc">$</span>windMV[isTest], prGrpTest,<span class="at">log=</span><span class="cn">TRUE</span>))</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(windGrplasso<span class="sc">$</span>lambda,predLLgrplasso,<span class="at">log=</span><span class="st">&quot;x&quot;</span>,<span class="at">type=</span><span class="st">&quot;l&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="data:image/png;base64,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" alt />
<p class="caption">plot of chunk code15.4</p>
</div>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>isBestLambdaGrplasso <span class="ot">=</span> <span class="fu">which</span>(predLLgrplasso<span class="sc">==</span><span class="fu">max</span>(predLLgrplasso))</span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">matplot</span>(windGrplasso<span class="sc">$</span>lambda,<span class="fu">t</span>(windGrplasso<span class="sc">$</span>coefficients),<span class="at">type=</span><span class="st">&quot;n&quot;</span>,<span class="at">log=</span><span class="st">&quot;x&quot;</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">matlines</span>(windGrplasso<span class="sc">$</span>lambda,<span class="fu">t</span>(windGrplasso<span class="sc">$</span>coefficients))</span></code></pre></div>
<div class="figure">
<img src="data:image/png;base64,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" alt />
<p class="caption">plot of chunk code15.4beta</p>
</div>
</div>
<div id="exercise-15.5-comparing-predictive-likelihoods-for-the-wind-farm-data" class="section level2">
<h2>Exercise 15.5: Comparing predictive likelihoods for the wind farm
data</h2>
<p><em>Compare the predictive log-likelihoods from Code Box 15.1 and
Figures 15.1c-d. These models were all applied using the same test
dataset. Which model seems to fit the data better? Why do you think this
is?</em></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="fu">sum</span>(predLogL),<span class="fu">sum</span>(predLogL_Int), <span class="fu">max</span>(predLLlasso), <span class="fu">max</span>(predLLgrplasso))</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] -830.5662 -832.3659 -744.2159 -739.6487</span></span></code></pre></div>
<p>The LASSO models fit way better, as expected. These models shrink
parameters together, borrowing strength across taxa. The two LASSO fits
did about as well as each other.</p>
</div>
<div id="code-box-15.5-reduced-rank-regression-for-the-wind-farm-data" class="section level2">
<h2>Code Box 15.5: Reduced rank regression for the wind farm data</h2>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(VGAM)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>wind_RR2<span class="ot">=</span><span class="fu">rrvglm</span>(<span class="fu">as.matrix</span>(windFarms<span class="sc">$</span>abund)<span class="sc">~</span>Year<span class="sc">*</span>Zone, <span class="at">family=</span>poissonff, <span class="at">data=</span>windFarms<span class="sc">$</span>X, <span class="at">Rank=</span><span class="dv">2</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>wind_manyglm <span class="ot">=</span> <span class="fu">manyglm</span>(windMV<span class="sc">~</span>Year<span class="sc">*</span>Zone, <span class="at">data=</span>windFarms<span class="sc">$</span>X, <span class="at">family=</span><span class="fu">poisson</span>())</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>( <span class="fu">BIC</span>(wind_RR2), <span class="fu">sum</span>(<span class="fu">BIC</span>(wind_manyglm)))</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 3318.548 3471.901</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>zoneyear <span class="ot">=</span> <span class="fu">interaction</span>(windFarms<span class="sc">$</span>X<span class="sc">$</span>Zone,windFarms<span class="sc">$</span>X<span class="sc">$</span>Year)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="fu">matplot</span>(<span class="fu">as.numeric</span>(zoneyear),<span class="fu">latvar</span>(wind_RR2),<span class="at">pch=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">19</span>))</span></code></pre></div>
<div class="figure">
<img src="data:image/png;base64,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" alt />
<p class="caption">plot of chunk code15.5</p>
</div>
<p><em>Which model fits better, according to BIC?</em></p>
<p>The reduced rank approach fits better.</p>
</div>
<div id="code-box-15.6-using-the-lasso-for-petruss-spider-data" class="section level2">
<h2>Code Box 15.6: Using the LASSO for Petrus’s spider data</h2>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mvabund)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(spider)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>spid.trait <span class="ot">=</span> <span class="fu">traitglm</span>(spider<span class="sc">$</span>abund,spider<span class="sc">$</span>x,<span class="at">method=</span><span class="st">&quot;cv.glm1path&quot;</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; No traits matrix entered, so will fit SDMs with different env response for each spp</span></span></code></pre></div>
<div class="figure">
<img src="data:image/png;base64,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" alt />
<p class="caption">plot of chunk code15.6</p>
</div>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lattice)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>a <span class="ot">=</span> <span class="fu">max</span>( <span class="fu">abs</span>(spid.trait<span class="sc">$</span>fourth.corner) )</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>colort <span class="ot">=</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>,<span class="st">&quot;white&quot;</span>,<span class="st">&quot;red&quot;</span>))</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>plot<span class="fl">.4</span>th <span class="ot">=</span> <span class="fu">levelplot</span>(<span class="fu">t</span>(<span class="fu">as.matrix</span>(spid.trait<span class="sc">$</span>fourth.corner)),</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="at">xlab=</span><span class="st">&quot;Environmental Variables&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;Species&quot;</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="at">col.regions=</span><span class="fu">colort</span>(<span class="dv">100</span>), <span class="at">at=</span><span class="fu">seq</span>(<span class="sc">-</span>a, a, <span class="at">length=</span><span class="dv">100</span>),</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="at">scales =</span> <span class="fu">list</span>( <span class="at">x=</span> <span class="fu">list</span>(<span class="at">rot =</span> <span class="dv">45</span>)) )</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(plot<span class="fl">.4</span>th)</span></code></pre></div>
<div class="figure">
<img src="data:image/png;base64,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" alt />
<p class="caption">plot of chunk code15.6</p>
</div>
<p><em>Which environmental variables seem to have the strongest effect
on spider abundances?</em></p>
<p><code>soil.dry</code> has some strongly negative coefficients,
<code>fallen.leaves</code> and <code>herb.layer</code> also have some
strong (but positive) interactions.</p>
</div>
<div id="code-box-15.7-mixed-model-prediction-of-spider-abundances" class="section level2">
<h2>Code Box 15.7: Mixed model prediction of spider abundances</h2>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>spidXY <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="fu">scale</span>(spider<span class="sc">$</span>x),spider<span class="sc">$</span>abund) <span class="co"># scale standardises data!</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>spiderLong <span class="ot">=</span> <span class="fu">melt</span>(<span class="at">id=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>,spidXY,<span class="at">variable.name=</span><span class="st">&quot;cols&quot;</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>Xformula <span class="ot">=</span> <span class="fu">paste</span>(<span class="fu">colnames</span>(spider<span class="sc">$</span>x),<span class="at">collapse=</span><span class="st">&quot;+&quot;</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>fullFormula <span class="ot">=</span> <span class="fu">formula</span>(<span class="fu">paste0</span>(<span class="st">&quot;value~cols+&quot;</span>,Xformula,<span class="st">&quot;+(&quot;</span>,Xformula,<span class="st">&quot;|cols)&quot;</span>))</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmmTMB)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>spid_glmm <span class="ot">=</span> <span class="fu">glmmTMB</span>(fullFormula,<span class="at">family=</span><span class="fu">nbinom2</span>(),<span class="at">data=</span>spiderLong)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in fitTMB(TMBStruc): Model convergence problem; non-positive-definite Hessian matrix.</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; See vignette(&#39;troubleshooting&#39;)</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in fitTMB(TMBStruc): Model convergence problem; false convergence (8). See</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; vignette(&#39;troubleshooting&#39;)</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(spid_glmm)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Family: nbinom2  ( log )</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Formula:          value ~ cols + soil.dry + bare.sand + fallen.leaves + moss +  </span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     herb.layer + reflection + (soil.dry + bare.sand + fallen.leaves +  </span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     moss + herb.layer + reflection | cols)</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Data: spiderLong</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      AIC      BIC   logLik deviance df.resid </span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       NA       NA       NA       NA      289 </span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Random effects:</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Conditional model:</span></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Groups Name          Variance Std.Dev. Corr                                </span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  cols   (Intercept)   0.6198   0.7873                                       </span></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         soil.dry      1.8397   1.3564   -0.88                               </span></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         bare.sand     0.1567   0.3959   -0.10 -0.08                         </span></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         fallen.leaves 0.4022   0.6342    0.67 -0.67 -0.68                   </span></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         moss          0.2354   0.4852   -0.70  0.40  0.51 -0.59             </span></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         herb.layer    0.6003   0.7748   -0.91  0.82 -0.20 -0.40  0.47       </span></span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         reflection    0.6677   0.8172    0.15 -0.52  0.33  0.20  0.40 -0.33 </span></span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Number of obs: 336, groups:  cols, 12</span></span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Dispersion parameter for nbinom2 family ():  1.5 </span></span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Conditional model:</span></span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;               Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; (Intercept)    0.16776    0.47850   0.351 0.725894    </span></span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; colsAlopcune   0.54986    0.33996   1.617 0.105785    </span></span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; colsAlopfabr  -1.63899    0.58105  -2.821 0.004792 ** </span></span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; colsArctlute  -1.97278    0.82953  -2.378 0.017398 *  </span></span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; colsArctperi  -4.54237    1.35504  -3.352 0.000802 ***</span></span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; colsAuloalbi   0.07721    0.53723   0.144 0.885718    </span></span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; colsPardlugu  -1.36175    0.81877  -1.663 0.096279 .  </span></span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; colsPardmont   1.70514    0.42854   3.979 6.92e-05 ***</span></span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; colsPardnigr   0.92672    0.65593   1.413 0.157703    </span></span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; colsPardpull   1.12798    0.72752   1.550 0.121034    </span></span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; colsTrocterr   2.26516    0.54456   4.160 3.19e-05 ***</span></span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; colsZoraspin   0.34212    0.69131   0.495 0.620682    </span></span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; soil.dry       0.65262    0.42430   1.538 0.124020    </span></span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; bare.sand      0.06150    0.15994   0.385 0.700601    </span></span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; fallen.leaves -0.35286    0.26457  -1.334 0.182309    </span></span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; moss           0.13402    0.18688   0.717 0.473289    </span></span>
<span id="cb19-55"><a href="#cb19-55" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; herb.layer     1.10662    0.27995   3.953 7.72e-05 ***</span></span>
<span id="cb19-56"><a href="#cb19-56" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; reflection    -0.03521    0.29688  -0.119 0.905585    </span></span>
<span id="cb19-57"><a href="#cb19-57" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ---</span></span>
<span id="cb19-58"><a href="#cb19-58" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span></code></pre></div>
<p>There are some convergence warnings here, which is fair enough
because there are only 12 species but heaps of correlated terms in this
model. Results seem to be reasonably stable on multiple runs, tweaking
some settings, so we’ll go with this fit.</p>
<p><em>Which predictors seem to be most important to spider community
composition?</em></p>
<p>The largest variance component, by some margin, is for
<code>soil.dry</code> (about 1.8), followed by <code>herb.layer</code>
and <code>reflection</code>.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
